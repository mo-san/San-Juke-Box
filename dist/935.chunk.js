"use strict";(self.webpackChunksan_juke_box=self.webpackChunksan_juke_box||[]).push([[935],{5935:(e,t,i)=>{i.r(t),i.d(t,{default:()=>P});var s,n,h,o,a,r,d,l,c,g,f,m,p,u,v,w,L,x,y=i(2738),z=i(7294),M=i(917),k=i(7939),R=i(6566),S=(i(7615),i(4700),i(6179),i(7523)),b=i(7135),W=i(7297),Z=function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)};const F=(e,t)=>t.getLayers()[0].getChildren((t=>t.name().startsWith(`Finger-${e}-`))).sort(((e,t)=>parseInt(e.name().substring(10))-parseInt(t.name().substring(10)))),C=(e,t)=>t.getLayers()[2].getChildren((t=>t.name()===`Palm-${e}`))[0];class E{constructor(e,t,i,y){if(this.timeThreshold=200,this.sumMovement=0,this.touchingFIngers={},this.startRecognition=()=>{this.handsRecognizer||(setTimeout(this.initializeRecognizer,1),new b.Camera(this.videoElement,{onFrame:async()=>await(this.handsRecognizer?.send({image:this.videoElement})),width:1,height:1}).start())},this.stopRecognition=()=>{this.handsRecognizer&&(this.handsRecognizer.close(),this.handsRecognizer=void 0)},this.initializeRecognizer=()=>{this.handsRecognizer=new S.Hands({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.3/${e}`}),this.handsRecognizer.setOptions(this.handOptions),this.handsRecognizer.onResults(Z(this,s,"f"))},s.set(this,(({multiHandLandmarks:e,multiHandedness:t})=>{if(this.stats&&this.stats.update(),t.length<1)return;const i="Left"===t[0].label?0:1;e.forEach(((e,t)=>{const s=t===i?"Left":"Right";Z(this,n,"f").call(this,s,e),Z(this,h,"f").call(this,s,e),Z(this,o,"f").call(this,s,e[9])}))})),n.set(this,((e,t)=>{const i=[[2,3,4],[6,7,8],[10,11,12],[14,15,16],[18,19,20],[0,1,5,9,13,17]];this.figures[e].fingers.forEach(((e,s)=>{e.points(i[s].map((e=>[t[e].x*window.innerWidth,t[e].y*window.innerHeight])).flat())})),this.figures[e].palm.closed(!0).points(i[5].map((e=>[t[e].x*window.innerWidth,t[e].y*window.innerHeight])).flat())})),h.set(this,((e,t)=>{const i=Z(this,a,"f").call(this,t);if(this.figures[e].penlight.visible(i),i){this.figures[e].penlight.position({x:(t[0].x+t[9].x)/2*window.innerWidth,y:(t[0].y+t[9].y)/2*window.innerHeight});const i=Z(this,f,"f").call(this,Z(this,l,"f").call(this,t));this.figures[e].penlight.rotation("Left"===e?-1*i:i)}})),o.set(this,((e,t)=>{const i=performance.now();if(i-this.figures[e].lastProcessedTime<=this.timeThreshold)return;this.figures[e].lastProcessedTime=i;const s=Z(this,r,"f").call(this,t,this.figures[e].lastCoord);this.figures[e].lastCoord={x:t.x,y:t.y};const n=this.sumMovement,h=W.o.getState().effectRankThreshold;for(let e=0;e<h.length;e++){const t=h[e];if(n<t&&n+s>=t){const t=0===e?4:1===e?3:2===e?2:3===e?1:0;W.o.setState({effectRank:t});break}}this.sumMovement+=s})),a.set(this,(e=>{const{x:t,y:i,z:s}=e[0],{x:n,y:h,z:o}=e[5],{x:a,y:r,z:l}=e[8],{x:c,y:g,z:f}=e[9],{x:m,y:p,z:u}=e[12],v={x:t-n,y:i-h,z:s-o},w={x:a-n,y:r-h,z:l-o},L=Z(this,d,"f").call(this,v,w),x={x:t-c,y:i-g,z:s-f},y={x:m-c,y:p-g,z:u-f},z=Z(this,d,"f").call(this,x,y);return L&&z})),r.set(this,(({x:e,y:t},{x:i,y:s})=>Math.sqrt((e-i)*(e-i)+(t-s)*(t-s)))),d.set(this,((e,t)=>{const i=Z(this,c,"f").call(this,e,t);return 0===i||Z(this,g,"f").call(this,e,t)/i>=0})),l.set(this,(e=>{const{x:t,y:i,z:s}=e[5],{x:n,y:h,z:o}=e[13],a={x:t-n,y:i-h,z:s-o},r={x:0,y:1,z:0},d=Z(this,c,"f").call(this,a,r);return Math.acos(0===d?0:Z(this,g,"f").call(this,a,r)/d)})),c.set(this,((e,t)=>Math.sqrt((e.x*e.x+e.y*e.y+e.z*e.z)*(t.x*t.x+t.y*t.y+t.z*t.z)))),g.set(this,((e,t)=>e.x*t.x+e.y*t.y+e.z*t.z)),f.set(this,(e=>57.29578*e)),m.set(this,(e=>{this.penLights[0].visible(!0),this.penLights[0].x(e.screenX),this.penLights[0].y(e.screenY)})),p.set(this,(e=>{this.penLights[0].visible(!1)})),u.set(this,(e=>{this.penLights[0].x(e.screenX),this.penLights[0].y(e.screenY)})),v.set(this,(e=>{const t=Object.keys(this.touchingFIngers).length;if(!(t>=10)){for(let i=0;i<Math.min(9,e.changedTouches.length);i++)this.touchingFIngers[e.changedTouches[i].identifier]=this.penLights[t];Object.entries(this.touchingFIngers).forEach((([,e])=>e.visible(!0)))}})),w.set(this,(e=>{for(let t=0;t<e.changedTouches.length;t++)this.touchingFIngers[e.changedTouches[t].identifier].visible(!1),delete this.touchingFIngers[e.changedTouches[t].identifier]})),L.set(this,(e=>{for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches[t],s=this.touchingFIngers[i.identifier];s.x(i.clientX),s.y(i.clientY)}})),x.set(this,(e=>{if(requestAnimationFrame(Z(this,x,"f")),W.o.getState().effectRank>=1){const t=Math.sin(e/1e3*Math.PI)*(1/3)+1/3;this.penLights.filter((e=>e.visible())).forEach((e=>e.brightness(t)))}if(!this.canUseCamera){const t=Math.asin(Math.sin(e/1e3*Math.PI)/1.41),i=Z(this,f,"f").call(this,t);this.penLights.filter((e=>e.visible())).forEach((e=>e.rotation(i)))}})),this.videoElement=t,this.stats=y,this.canUseCamera=i,this.handOptions={maxNumHands:W.o.getState().maxHands,minDetectionConfidence:.5,minTrackingConfidence:.5,selfieMode:W.o.getState().selfieMode},this.penLights=e.current.getLayers()[1].getChildren((e=>/Light-\d+/.test(e.name()))),this.figures={Left:{fingers:F("L",e.current),penlight:this.penLights[0],palm:C("L",e.current),lastCoord:{x:0,y:0},lastProcessedTime:0},Right:{fingers:F("R",e.current),penlight:this.penLights[1],palm:C("R",e.current),lastCoord:{x:0,y:0},lastProcessedTime:0}},W.o.subscribe((e=>this.handsRecognizer?.setOptions({...this.handOptions,selfieMode:e})),(e=>e.selfieMode)),!this.canUseCamera){const e=this.penLights[0].height();this.penLights.forEach((t=>t.offsetY(4*e/5))),W.o.getState().isTouchDevice?(document.addEventListener("touchstart",Z(this,v,"f")),document.addEventListener("touchend",Z(this,w,"f")),document.addEventListener("touchmove",Z(this,L,"f"))):(document.addEventListener("mousedown",Z(this,m,"f")),document.addEventListener("mouseup",Z(this,p,"f")),document.addEventListener("mousemove",Z(this,u,"f")))}Z(this,x,"f").call(this,0)}}s=new WeakMap,n=new WeakMap,h=new WeakMap,o=new WeakMap,a=new WeakMap,r=new WeakMap,d=new WeakMap,l=new WeakMap,c=new WeakMap,g=new WeakMap,f=new WeakMap,m=new WeakMap,p=new WeakMap,u=new WeakMap,v=new WeakMap,w=new WeakMap,L=new WeakMap,x=new WeakMap;var T=i(9957);const H=({points:e,name:t})=>(0,y.tZ)(R.x1,{name:t,points:e,tension:.5,stroke:"#444444",strokeWidth:30,fill:"#e0e0e0",lineCap:"round",lineJoin:"round"},void 0),I=({ref:e,name:t,fillStops:i})=>{const s=2*window.innerHeight/3,n=s/5;return(0,y.tZ)(R.UL,{ref:e,name:t,x:0,y:0,width:n,height:s,fillLinearGradientStartPoint:{x:0,y:s/2},fillLinearGradientEndPoint:{x:n,y:s/2},fillLinearGradientColorStops:i,filters:[k.Q],cornerRadius:10,offsetX:n/2,offsetY:s/4,visible:!1},void 0)},P=({zIndex:e})=>{const t=(0,z.useRef)(null),i=(0,z.useRef)(null),s=W.o.getState().colorLightFillStops,n=W.o.getState().selectedModelNames[0],h=()=>{i.current?.width(window.innerWidth),i.current?.height(window.innerHeight)};return(0,z.useEffect)((()=>{document.querySelector("#fps-hands").appendChild(T.Lq.dom);const e=t.current,s=W.o.getState().useCamera,n=new E(i,e,s,T.Lq);s&&(W.o.setState({startRecognition:n.startRecognition}),W.o.setState({stopRecognition:n.stopRecognition})),window.addEventListener("resize",h)}),[]),(0,y.BX)(y.HY,{children:[(0,y.tZ)("video",{id:"video-hands",ref:t,css:M.iv`
          display: none;
          z-index: ${e-1};
          position: fixed;
          top: 0;
          left: 0;
          transform: scaleX(-1); /* flip horizontally */
        `},void 0),(0,y.BX)(R.Hf,Object.assign({width:window.innerWidth,height:window.innerHeight,ref:i,css:M.iv`
          display: block;
          z-index: ${e};
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          max-width: 100vw;
          height: 100vh;
          max-height: 100vh;
        `},{children:[(0,y.BX)(R.mh,{children:[(0,y.tZ)(H,{name:"Finger-L-1"},void 0),(0,y.tZ)(H,{name:"Finger-L-2"},void 0),(0,y.tZ)(H,{name:"Finger-L-3"},void 0),(0,y.tZ)(H,{name:"Finger-L-4"},void 0),(0,y.tZ)(H,{name:"Finger-L-5"},void 0),(0,y.tZ)(H,{name:"Finger-R-1"},void 0),(0,y.tZ)(H,{name:"Finger-R-2"},void 0),(0,y.tZ)(H,{name:"Finger-R-3"},void 0),(0,y.tZ)(H,{name:"Finger-R-4"},void 0),(0,y.tZ)(H,{name:"Finger-R-5"},void 0)]},void 0),(0,y.BX)(R.mh,{children:[(0,y.tZ)(I,{name:"Light-0",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-1",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-2",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-3",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-4",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-5",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-6",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-7",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-8",fillStops:s[n]},void 0),(0,y.tZ)(I,{name:"Light-9",fillStops:s[n]},void 0)]},void 0),(0,y.BX)(R.mh,{children:[(0,y.tZ)(H,{name:"Palm-L"},void 0),(0,y.tZ)(H,{name:"Palm-R"},void 0)]},void 0)]}),void 0)]},void 0)}}}]);
//# sourceMappingURL=935.chunk.js.map